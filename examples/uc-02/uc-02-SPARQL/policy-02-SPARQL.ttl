@prefix dcterms:       <http://purl.org/dc/terms/> .
@prefix dpv-odrl:      <https://w3id.org/dpv/mappings/odrl#> .
@prefix ehds:          <https://w3c.github.io/dpv/2.1/legal/eu/ehds/> .
@prefix ex:            <https://example.org/> .
@prefix odrl:          <http://www.w3.org/ns/odrl/2/> .
@prefix report:        <https://w3id.org/force/compliance-report#> .
@prefix rdf:           <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix sector-health: <https://w3id.org/dpv/sector/health#> .

ex:uc02-SPARQL-p-weight-primarycare-read a odrl:Set ;
    odrl:uid ex:uc02-SPARQL-p-weight-primarycare-read ;
    dcterms:description "Patient allows her weight subset of health data to be read for primary care. SPARQL query." ;
    odrl:permission [
        odrl:action odrl:read ;
        odrl:target [
            a odrl:Asset ;
            dcterms:description "SPARQL query to fetch patient weight data";
            rdf:value """
                PREFIX ex: <https://example.org/ns#>
                SELECT ?date ?weight ?measurer
                WHERE {
                    GRAPH ex:health-data {
                        ex:patient ex:weight ?weight ;
                                ex:measurementDate ?date ;
                                ex:measuredBy ?measurer .
                        ?measurer a ehds:HealthcareProvider .
                    }
                }
                ORDER BY ?date
                """ ;
            ] ; 
        odrl:assigner ex:patient ;
        odrl:constraint [
            odrl:leftOperand dpv-odrl:Purpose ;
            odrl:operator odrl:eq ;
            odrl:rightOperand sector-health:PrimaryCareManagement ] ] .
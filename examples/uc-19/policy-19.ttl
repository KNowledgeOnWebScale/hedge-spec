@prefix dcterms:       <http://purl.org/dc/terms/> .
@prefix dpv:           <https://w3id.org/dpv#> .
@prefix dpv-odrl:      <https://w3id.org/dpv/mappings/odrl#> .
@prefix ehds:          <https://w3c.github.io/dpv/2.1/legal/eu/ehds/> .
@prefix ex:            <https://example.org/> .
@prefix loinc:         <http://loinc.org/id/> .
@prefix odrl:          <http://www.w3.org/ns/odrl/2/> .
@prefix rdf:           <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix sector-health: <https://w3id.org/dpv/sector/health#> .
@prefix time:          <http://www.w3.org/2006/time#> .
@prefix ucum:          <http://unitsofmeasure.org/ucum.html#> .

ex:uc19-p-labresults-privatesharing-noDC-read a odrl:Set ;
    odrl:uid ex:uc19-p-labresults-privatesharing-noDC-read ;
    dcterms:description "User allows a specific glucose test result, subset of health data, to be read by a non-healthcare professional for 24h. SPARQL query."@en ;
    odrl:permission [
        odrl:action odrl:read ;
        odrl:target [
            a odrl:Asset ;
            dcterms:description "SPARQL query to fetch user's blood glucose lab results data"@en;
            rdf:value """
                PREFIX dpv: <https://w3id.org/dpv#>
                PREFIX ehds: <https://w3c.github.io/dpv/2.1/legal/eu/ehds/>
                PREFIX ex: <https://example.org/ns#>
                PREFIX loinc: <http://loinc.org/id/>
                PREFIX ucum: <http://unitsofmeasure.org/ucum.html#>

                SELECT ?date ?resultValue ?resultUnit
                WHERE {
                    GRAPH ex:lab-test-results {
                        ex:user19 ex:labTestResult ?testResult ;
                                ex:measurementDate ?date .

                        ?testResult ex:testType loinc:2345-7 ;  # Glucose test (LOINC 2345-7)
                                    ex:resultValue ?resultValue ;
                                    ex:resultUnit ucum:mg/dL .  # Strict UCUM unit validation
                    }
                }
                ORDER BY ?date
                """ ;
            ] ; 
        odrl:assigner ex:user19 ;
        dpv:DataSubject ex:user19 ;
        dpv:Recipient ex:nonHealthcareProfessional ;
        odrl:constraint [
            odrl:leftOperand dpv-odrl:Purpose ;
            odrl:operator odrl:isAnyOf ;
            odrl:rightOperand dpv:NonCommercialPurpose, dpv:RequestedServiceProvision, sector-health:ResourceManagement, ex:SecondOpinion ], [
            odrl:leftOperand odrl:elapsedTime ;
            odrl:operator odrl:lteq ;  # Duration â‰¤ 24h
            odrl:rightOperand [
                a time:Duration ;
                time:unitType time:unitHour ;
                time:numericDuration 24 ] ] ] .
        